/*!
 * @oktarintentakel/annex v0.1.17-beta
 */
/*!
 * Module Navigation
 */
const MODULE_NAME="Navigation";import{warn}from"./logging.js";import{hasValue,orDefault,isPlainObject,isArray,isWindow,isFunction,assert}from"./basic.js";import{createNode}from"./elements.js";import{browserSupportsHistoryManipulation}from"./context.js";import{urlHref}from"./urls.js";export const HISTORY={current:{state:null,title:"",...getHostAndPathname()},popState:{listening:!1,callbacks:[],handler(t){const o={state:t.state,title:t.title,...getHostAndPathname()};HISTORY.popState.callbacks.forEach((e=>{e.stateful(t,o)})),HISTORY.current=o}}};function getHostAndPathname(){const t={host:void 0,pathname:void 0};try{t.host=window.location.host,t.pathname=window.location.pathname}catch(o){t.host=void 0,t.pathname=void 0}return t}export function redirect(t=null,o=null,e=null,n=null,a=null,l=!1){if(t=urlHref(t,o,e,l),n=orDefault(n,null,"str"),a=isPlainObject(a)?a:null,hasValue(a)){const o={method:"post",action:t,"data-ajax":"false"};hasValue(n)&&(o.target=n);const e=createNode("form",o);for(let t in a)isArray(a[t])?a[t].forEach((o=>{e.appendChild(createNode("input",{type:"hidden",name:`${t}[]`,value:`${o}`}))})):e.appendChild(createNode("input",{type:"hidden",name:t,value:`${a[t]}`}));document.body.appendChild(e),e.submit(),document.body.removeChild(e)}else if(hasValue(n)){if(new URL(t).origin!==window.location.origin){const o=document.createElement("a");o.href=t,o.target=n,o.rel="noopener noreferrer",document.body.appendChild(o),o.click(),o.parentNode.removeChild(o)}else window.open(t,n)}else window.location.assign(t)}export function openTab(t,o=null,e=null,n=null){redirect(t,o,e,"_blank",n)}export function openWindow(t=null,o=null,e=null,n=!1){t=urlHref(t),o=isPlainObject(o)?o:null,e=isWindow(e)?e:window,n=orDefault(n,!1,"bool");let a="";const l=[];if(hasValue(o))for(let t in o)"name"===t&&(a=o[t]),("name"!==t||n)&&([!0,1,"yes"].includes(o[t])?l.push(`${t}`):l.push(`${t}=${o[t]}`));return e.open(t,a,l.join(","))}export function reload(t=!0,o=!0){if(t=orDefault(t,!0,"bool"),o=orDefault(o,!0,"bool"),!t&&o){const t=document.createElement("form");t.method="post",t.action=window.location.href,document.body.appendChild(t),t.submit(),document.body.removeChild(t)}else t||o?window.location.reload():window.location.replace(window.location.href)}export function changeCurrentUrl(t=null,o=!1,e=null,n=null){t=urlHref(t),o=orDefault(o,!1,"bool"),n=orDefault(n,"","str"),browserSupportsHistoryManipulation()?(o?window.history.pushState(e,n,t):window.history.replaceState(e,n,t),HISTORY.current={state:e,title:n,host:window.location.host,path:window.location.pathname}):warn(`${MODULE_NAME}:changeCurrentUrl | this browser does not support history api, skipping`)}export function onHistoryChange(t,o=!1,e=!1){const n="onHistoryChange";if(o=orDefault(o,!1,"bool"),e=orDefault(e,!1,"bool"),assert(isFunction(t),`${MODULE_NAME}:${n} | callback is no function`),browserSupportsHistoryManipulation()){o&&(HISTORY.popState.callbacks=[]);const n=function(o,n){e?t(HISTORY.current,n):t(n)};HISTORY.popState.callbacks.push({original:t,stateful:n}),HISTORY.popState.listening||(HISTORY.popState.listening=!0,window.addEventListener("popstate",HISTORY.popState.handler))}else warn(`${MODULE_NAME}:${n} | this browser does not support history api, skipping`)}export function offHistoryChange(t=null){if(hasValue(t)){assert(isFunction(t),`${MODULE_NAME}:offHistoryChange | callback is not a function`);const o=HISTORY.popState.callbacks.length;HISTORY.popState.callbacks=HISTORY.popState.callbacks.reduce(((o,e)=>(e.original!==t&&o.push(e),o)),[]);const e=HISTORY.popState.callbacks.length;return 0===e&&(window.removeEventListener("popstate",HISTORY.popState.handler),HISTORY.popState.listening=!1),o>e}return HISTORY.popState.callbacks=[],window.removeEventListener("popstate",HISTORY.popState.handler),HISTORY.popState.listening=!1,!0}
//# sourceMappingURL=navigation.js.map
