{"version":3,"file":"animation.js","names":["MODULE_NAME","hasValue","isA","isPlainObject","isEmpty","isNaN","orDefault","assert","Deferred","warn","pschedule","countermand","waitForRepaint","applyStyles","RUNNING_TRANSITIONS","WeakMap","EasingFunctions","linear","t","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","transition","element","classChanges","styleChanges","rejectOnInterruption","__methodName__","deferred","runningTransition","get","timer","error","Error","reject","resolve","delete","transitionDurationProperties","transitionProperties","timingProperties","transitionDefinition","property","value","vendorPropertiesAdded","forEach","properties","transitionValue","remove","concat","removeClass","split","classList","trim","add","addClass","elementStyles","getComputedStyle","timingProperty","sTimings","match","msTimings","longestTiming","timing","parseFloat","Math","floor","parseInt","set"],"sources":["animation.js"],"mappings":"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","sourcesContent":["/*!\n * Module Animation\n */\n\n/**\n * @namespace Animation\n */\n\nconst MODULE_NAME = 'Animation';\n\n\n\n//###[ IMPORTS ]########################################################################################################\n\nimport {hasValue, isA, isPlainObject, isEmpty, isNaN, orDefault, assert, Deferred} from './basic.js';\nimport {warn} from './logging.js';\nimport {pschedule, countermand, waitForRepaint} from './timers.js';\nimport {applyStyles} from './css.js';\n\n\n\n//###[ DATA ]###########################################################################################################\n\nconst RUNNING_TRANSITIONS = new WeakMap();\n\n\n\n//###[ EXPORTS ]########################################################################################################\n\n/**\n * @namespace Animation:EasingFunctions\n */\n\n/**\n * A collection of all basic easing functions to be used in animations.\n * All functions here take a float parameter between 0 and 1 and return a mapped value between 0 and 1.\n *\n * Taken from: https://gist.github.com/gre/1650294\n *\n * Available functions:\n * - linear\n * - easeInQuad\n * - easeOutQuad\n * - easeInOutQuad\n * - easeInCubic\n * - easeOutCubic\n * - easeInOutCubic\n * - easeInQuart\n * - easeOutQuart\n * - easeInOutQuart\n * - easeInQuint\n * - easeOutQuint\n * - easeInOutQuint\n *\n * @memberof Animation:EasingFunctions\n * @alias EasingFunctions\n * @example\n * scrollTo(window, 1000, 0, EasingFunctions.easeInOutQuint);\n */\nexport const EasingFunctions = {\n\t// no easing, no acceleration\n\tlinear : t => t,\n\t// accelerating from zero velocity\n\teaseInQuad : t => t*t,\n\t// decelerating to zero velocity\n\teaseOutQuad : t => t*(2-t),\n\t// acceleration until halfway, then deceleration\n\teaseInOutQuad : t => t<.5 ? 2*t*t : -1+(4-2*t)*t,\n\t// accelerating from zero velocity\n\teaseInCubic : t => t*t*t,\n\t// decelerating to zero velocity\n\teaseOutCubic : t => (--t)*t*t+1,\n\t// acceleration until halfway, then deceleration\n\teaseInOutCubic : t => t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1,\n\t// accelerating from zero velocity\n\teaseInQuart : t => t*t*t*t,\n\t// decelerating to zero velocity\n\teaseOutQuart : t => 1-(--t)*t*t*t,\n\t// acceleration until halfway, then deceleration\n\teaseInOutQuart : t => t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t,\n\t// accelerating from zero velocity\n\teaseInQuint : t => t*t*t*t*t,\n\t// decelerating to zero velocity\n\teaseOutQuint : t => 1+(--t)*t*t*t*t,\n\t// acceleration until halfway, then deceleration\n\teaseInOutQuint : t => t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t\n};\n\n\n\n/**\n * @namespace Animation:transition\n */\n\n/**\n * This method offers the possibility to apply CSS transitions via classes and/or styles and wait for the transition\n * to finish, which results in the resolution of a Deferred.\n *\n * In general, this method remedies the pain of having to manage transitions manually in JS, entering precise ms for\n * timers waiting on conclusion of transitions.\n *\n * The general principle of this is the parsing of transition CSS attributes, which may contain transition\n * timings (transition and transition-duration) and looks for the longest currently running transition.\n * Values are excepted as milliseconds or seconds (int or float notation).\n *\n * Why would you do this, if there is something like the `animationend` event, you ask? Well, the problem is, that,\n * if the animation is interrupted or never finishes for any other reason, the event never fires. For that, there is\n * the `animationcancel` event, but that is not really robustly supported at the moment. So, in cases of complex\n * style changes, where we definitively want to have a callback when the animation has been (or would have been)\n * finished, this is still the safer option. But, for simple and small cases I'd strongly recommend using the native\n * `AnimationEvent` API.\n *\n * Calling this method successively on the same element replaces the currently running transition, normally\n * resulting in premature resolution of the Deferred and application of the newly provided changes.\n *\n * Be advised, that legacy browsers like IE11 and Edge <= 18 have problems connecting interrupted transitions,\n * especially when transition-durations change during animation, resulting in skipped or choppy animations. If you\n * experience this, try to keep timings stable during animation and chain animations without overlap.\n *\n * @param {Element} element - the element to transition, by applying class and/or style changes\n * @param {?Object} [classChanges=null] - plain object containing class changes to apply, add classes via the \"add\" key, remove them via the \"remove\" key (add has precedence over remove); values may be standard CSS class string notation or an array of standard CSS class notations\n * @param {?Object} [styleChanges=null] - plain object containing style changes to apply (via applyStyles)\n * @param {?Boolean} [rejectOnInterruption=false] - if a new transition is applied using this function while a previous transition is still running the Deferred would normally be resolved before continuing, set this to true to let the Deferred reject in that case (the rejection message is \"interrupted\", access the element using \"element)\n * @return {Deferred} resolves on transition completion or repeated call on the same element, with the resolution value being the element, rejects on repeated call on same element if rejectOnInterruption is true (the rejection message is \"interrupted\", access the element using \"element\")\n *\n * @memberof Animation:transition\n * @alias transition\n * @see applyStyles\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/animationend_event\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/animationcancel_event\n * @example\n * transition(element, {add : 'foobar'}).then(element => { return transition(element, {remove : 'foobar'}); }).then(() => { console.log('finished'); });\n * transition(element, null, {top : 0, left : 0, background : 'pink', transition : 'all 1500ms'}).then(() => { console.log('finished'); });\n * transition(element, {add : 'foobar'}).then(() => { console.log('finished'); }).catch(error => { console.log('cancelled'); });\n */\nexport function transition(element, classChanges=null, styleChanges=null, rejectOnInterruption=false){\n\tconst __methodName__ = 'cssTransition';\n\n\tclassChanges = orDefault(classChanges, {});\n\tstyleChanges = orDefault(styleChanges, {});\n\trejectOnInterruption = orDefault(rejectOnInterruption, false, 'bool');\n\n\tassert(isA(element, 'htmlelement'), `${MODULE_NAME}:${__methodName__} | element is not usable`);\n\tassert(isPlainObject(classChanges), `${MODULE_NAME}:${__methodName__} | classChanges is not a plain object`);\n\tassert(isPlainObject(styleChanges), `${MODULE_NAME}:${__methodName__} | styleChanges is not a plain object`);\n\n\tconst\n\t\tdeferred = new Deferred(),\n\t\trunningTransition = RUNNING_TRANSITIONS.get(element)\n\t;\n\n\tif( hasValue(runningTransition) ){\n\t\tcountermand(runningTransition.timer);\n\t\tif( !rejectOnInterruption ){\n\t\t\trunningTransition.deferred.resolve(element);\n\t\t} else {\n\t\t\tconst error = new Error('interrupted');\n\t\t\terror.element = element;\n\t\t\trunningTransition.deferred.reject(error);\n\t\t}\n\t}\n\tRUNNING_TRANSITIONS.delete(element);\n\n\tconst\n\t\ttransitionDurationProperties = [\n\t\t\t'transition-duration',\n\t\t\t'-webkit-transition-duration',\n\t\t\t'-moz-transition-duration',\n\t\t\t'-o-transition-duration'\n\t\t],\n\t\ttransitionProperties = [\n\t\t\t'transition',\n\t\t\t'-webkit-transition',\n\t\t\t'-moz-transition',\n\t\t\t'-o-transition'\n\t\t],\n\t\ttimingProperties = [\n\t\t\t...transitionDurationProperties,\n\t\t\t...transitionProperties\n\t\t],\n\t\ttransitionDefinition = {\n\t\t\tproperty : null,\n\t\t\tvalue : null\n\t\t}\n\t;\n\n\tif( !isEmpty(styleChanges) ){\n\t\tlet vendorPropertiesAdded;\n\t\t[transitionDurationProperties, transitionProperties].forEach(properties => {\n\t\t\tvendorPropertiesAdded = false;\n\t\t\tproperties.forEach(property => {\n\t\t\t\tconst transitionValue = styleChanges[property];\n\t\t\t\tif( !vendorPropertiesAdded && hasValue(transitionValue) ){\n\t\t\t\t\tvendorPropertiesAdded = true;\n\t\t\t\t\tproperties.forEach(property => {\n\t\t\t\t\t\tstyleChanges[property] = transitionValue;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tapplyStyles(element, styleChanges);\n\t}\n\n\tif( !isEmpty(classChanges?.remove) ){\n\t\t[].concat(classChanges.remove).forEach(removeClass => {\n\t\t\t`${removeClass}`.split(' ').forEach(removeClass => {\n\t\t\t\telement.classList.remove(removeClass.trim());\n\t\t\t});\n\t\t});\n\t}\n\n\tif( !isEmpty(classChanges?.add) ){\n\t\t[].concat(classChanges.add).forEach(addClass => {\n\t\t\t`${addClass}`.split(' ').forEach(addClass => {\n\t\t\t\telement.classList.add(addClass.trim());\n\t\t\t});\n\t\t});\n\t}\n\n\twaitForRepaint(() => {\n\t\tconst elementStyles = getComputedStyle(element);\n\t\ttimingProperties.forEach(timingProperty => {\n\t\t\tif( !hasValue(transitionDefinition.value) && hasValue(elementStyles[timingProperty]) ){\n\t\t\t\ttransitionDefinition.property = timingProperty;\n\t\t\t\ttransitionDefinition.value = elementStyles[timingProperty];\n\t\t\t}\n\t\t});\n\n\t\tif( !hasValue(transitionDefinition.value) ){\n\t\t\twarn(`${MODULE_NAME}:${__methodName__} | no usable transitions on element \"${element}\"`);\n\t\t\tdeferred.resolve(element);\n\t\t} else {\n\t\t\tconst\n\t\t\t\tsTimings = transitionDefinition.value.match(/(^|\\s)(\\d+(\\.\\d+)?)s(\\s|,|$)/g),\n\t\t\t\tmsTimings = transitionDefinition.value.match(/(^|\\s)(\\d+)ms(\\s|,|$)/g)\n\t\t\t;\n\t\t\tlet\tlongestTiming = 0;\n\n\t\t\t(sTimings ?? []).forEach(timing => {\n\t\t\t\ttiming = parseFloat(timing);\n\n\t\t\t\tif( !isNaN(timing) ){\n\t\t\t\t\ttiming = Math.floor(timing * 1000);\n\n\t\t\t\t\tif( timing > longestTiming ){\n\t\t\t\t\t\tlongestTiming = timing;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t(msTimings ?? []).forEach(timing => {\n\t\t\t\ttiming = parseInt(timing, 10);\n\n\t\t\t\tif( !isNaN(timing) && (timing > longestTiming) ){\n\t\t\t\t\tlongestTiming = timing;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRUNNING_TRANSITIONS.set(element, {\n\t\t\t\tdeferred,\n\t\t\t\ttimer : pschedule(longestTiming, () => {\n\t\t\t\t\twaitForRepaint(() => {\n\t\t\t\t\t\tdeferred.resolve(element);\n\t\t\t\t\t\tRUNNING_TRANSITIONS.delete(element);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t});\n\n\treturn deferred;\n}\n"]}