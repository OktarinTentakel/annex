/*!
 * @oktarintentakel/annex v0.1.14-beta
 */
/*!
 * Module Polling
 */
const MODULE_NAME="Polling";import{orDefault,isFunction,isObject,assert,hasValue}from"./basic.js";import{loop,countermand}from"./timers.js";export const POLLS={defaultLoop:null,activePollCount:0,activePolls:{}};const POLL_DEFAULT_LOOP_MS=250;export function poll(l,o,t,e=null,n=250,a=!1){l=orDefault(l,"","str").trim(),e=isFunction(e)?e:()=>{},n=orDefault(n,250,"int"),a=orDefault(a,!1,"bool"),assert(""!==l,"Polling:poll | name is missing"),assert(isFunction(o),"Polling:poll | fCondition is not a function"),assert(isFunction(t),"Polling:poll | fAction is not a function");const i={name:l,condition:o,action:t,elseAction:e,loop:null,lastPollResult:!1,isActive:!0,fire(l=null){hasValue(POLLS.activePolls[i.name])&&(i.condition()?(!0===i.action(hasValue(l)?!!l:!1===i.lastPollResult)&&(hasValue(i.loop)&&(countermand(i.loop),i.loop=null),i.isActive=!1,delete POLLS.activePolls[i.name],POLLS.activePollCount--),i.lastPollResult=!0):(i.elseAction(hasValue(l)?!!l:!0===i.lastPollResult),i.lastPollResult=!1))}};return a&&(i.loop=loop(n,(function(){i.fire()}))),hasValue(POLLS.activePolls[l])&&unpoll(l),POLLS.activePolls[l]=i,POLLS.activePollCount++,(!hasValue(POLLS.defaultLoop)||250!==n&&!a)&&POLLS.activePollCount>0&&(hasValue(POLLS.defaultLoop)&&countermand(POLLS.defaultLoop),POLLS.defaultLoop=loop(n,(function(){if(POLLS.activePollCount>0){for(let l in POLLS.activePolls)if(POLLS.activePolls.hasOwnProperty(l)){const o=POLLS.activePolls[l];hasValue(o.loop)||o.fire()}}else countermand(POLLS.defaultLoop),POLLS.defaultLoop=null}))),i}export function unpoll(l){const o=isObject(l)&&hasValue(l.name)?`${l.name}`:`${l}`.trim();return""!==o&&(l=POLLS.activePolls[o],!!hasValue(l)&&(hasValue(l.loop)&&countermand(l.loop),l.isActive=!1,delete POLLS.activePolls[l.name],POLLS.activePollCount--,POLLS.activePollCount<=0&&(countermand(POLLS.defaultLoop),POLLS.defaultLoop=null,POLLS.activePollCount=0),!0))}
//# sourceMappingURL=polling.js.map
