/*!
 * @oktarintentakel/annex v0.1.9-beta
 */
/*!
 * Module Images
 */
const MODULE_NAME="Images";import{orDefault,isArray,isPlainObject,assert,isEmpty,isElement,hasValue,Deferred}from"./basic.js";import{waitForRepaint}from"./timers.js";const PRELOADED_IMAGES={unnamed:[],named:{}};export function preload(e){const r=[],t=new Deferred;let n;if(!isPlainObject(e)&&!isArray(e)){if(e=`${e}`,hasValue(PRELOADED_IMAGES.named[e]))return PRELOADED_IMAGES.named[e];e=[e]}return isPlainObject(e)?(n={},Object.entries(e).forEach((([e,t])=>{e=`${e}`,t=`${t}`,hasValue(PRELOADED_IMAGES.named[e])||(n[e]=new Image,n[e].src=t,r.push(n[e]))})),PRELOADED_IMAGES.named={...PRELOADED_IMAGES.named,...n}):isArray(e)&&(n=[],e.forEach((e=>{const t=new Image;t.src=`${e}`,n.push(t),r.push(t)})),PRELOADED_IMAGES.unnamed=Array.from(new Set(PRELOADED_IMAGES.unnamed.concat(n)))),t.provision=isArray(n)&&1===n.length?n[0]:n,loaded(r).then(t.resolve).catch(t.reject),t}export function loaded(e,r=!1){function t(i){const m=i.currentTarget;!r||r&&m.naturalWidth>0?(s--,s<=0&&(e.map((e=>{e.removeEventListener("load",t),e.removeEventListener("error",n)})),a.map((e=>{e.removeEventListener("load",t),e.removeEventListener("error",n)})),o.resolve(1===e.length?e[0]:e))):waitForRepaint((()=>{t(i)}))}function n(r){e.map((e=>{e.removeEventListener("load",t),e.removeEventListener("error",n)})),a.map((e=>{e.removeEventListener("load",t),e.removeEventListener("error",n)})),o.reject(r)}e=orDefault(e,[],"arr").filter((e=>"htmlimageelement"===Object.prototype.toString.call(e).slice(8,-1).toLowerCase())),r=orDefault(r,!1,"bool");const o=new Deferred,a=[];let s=e.length;return o.provision=1===e.length?e[0]:e,e.forEach((e=>{e.removeEventListener("load",t),e.addEventListener("load",t),e.removeEventListener("error",n),e.addEventListener("error",n);const r=e.src,o=e.parentNode,s=!!isElement(e.parentNode)&&"picture"===o.nodeName.toLowerCase();if(assert(!isEmpty(r),"Images:loaded | image has no src"),s||e.complete){let i;s?(window.respimage?(window.respimage({elements:[o]}),i=o.querySelector("img")):window.picturefill?(window.picturefill({elements:[o]}),i=o.querySelector("img")):i=e,i.complete?(i=new Image,i.addEventListener("load",t),i.addEventListener("error",n),i.src=r,a.push(i)):(i.removeEventListener("load",t),i.addEventListener("load",t),i.removeEventListener("error",n),i.addEventListener("error",n))):(i=new Image,i.addEventListener("load",t),i.addEventListener("error",n),i.src=r,a.push(i))}})),o}
//# sourceMappingURL=images.js.map
