/*!
 * @oktarintentakel/annex v0.1.2-beta
 */
/*!
 * Module Polling
 */
const MODULE_NAME="Polling";import{orDefault,isA,assert,hasValue}from"./basic.js";import{loop,countermand}from"./timers.js";export const POLLS={defaultLoop:null,activePollCount:0,activePolls:{}};const POLL_DEFAULT_LOOP_MS=250;export function poll(l,o,t,e=null,a=250,n=!1){l=orDefault(l,"","str").trim(),e=isA(e,"function")?e:()=>{},a=orDefault(a,250,"int"),n=orDefault(n,!1,"bool"),assert(""!==l,"Polling:poll | name is missing"),assert(isA(o,"function"),"Polling:poll | fCondition is not a function"),assert(isA(t,"function"),"Polling:poll | fAction is not a function");const i={name:l,condition:o,action:t,elseAction:e,loop:null,lastPollResult:!1,isActive:!0,fire(l=null){hasValue(POLLS.activePolls[i.name])&&(i.condition()?(!0===i.action(hasValue(l)?!!l:!1===i.lastPollResult)&&(hasValue(i.loop)&&(countermand(i.loop),i.loop=null),i.isActive=!1,delete POLLS.activePolls[i.name],POLLS.activePollCount--),i.lastPollResult=!0):(i.elseAction(hasValue(l)?!!l:!0===i.lastPollResult),i.lastPollResult=!1))}};return n&&(i.loop=loop(a,(function(){i.fire()}))),hasValue(POLLS.activePolls[l])&&unpoll(l),POLLS.activePolls[l]=i,POLLS.activePollCount++,(!hasValue(POLLS.defaultLoop)||250!==a&&!n)&&POLLS.activePollCount>0&&(hasValue(POLLS.defaultLoop)&&countermand(POLLS.defaultLoop),POLLS.defaultLoop=loop(a,(function(){if(POLLS.activePollCount>0){for(let l in POLLS.activePolls)if(POLLS.activePolls.hasOwnProperty(l)){const o=POLLS.activePolls[l];hasValue(o.loop)||o.fire()}}else countermand(POLLS.defaultLoop),POLLS.defaultLoop=null}))),i}export function unpoll(l){const o=isA(l,"object")&&hasValue(l.name)?`${l.name}`:`${l}`.trim();return""!==o&&(l=POLLS.activePolls[o],!!hasValue(l)&&(hasValue(l.loop)&&countermand(l.loop),l.isActive=!1,delete POLLS.activePolls[l.name],POLLS.activePollCount--,POLLS.activePollCount<=0&&(countermand(POLLS.defaultLoop),POLLS.defaultLoop=null,POLLS.activePollCount=0),!0))}
//# sourceMappingURL=polling.js.map
